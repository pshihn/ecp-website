function t(t){let s=-1;return self.Touch&&t instanceof Touch?s=t.identifier:e(t)&&(s=t.pointerId),{id:s,nativeEvent:t,clientX:t.clientX,clientY:t.clientY}}const e=t=>self.PointerEvent&&t instanceof PointerEvent;class s{constructor(s,i){this.startPointers=[],this.currentPointers=[],this.pointerStart=s=>{if(0===s.button&&this.triggerPointerStart(t(s),s))if(e(s)){(s.target&&"setPointerCapture"in s.target?s.target:this._e).setPointerCapture(s.pointerId),this.ael("pointermove",this.move),this.ael("pointerup",this.pointerEnd),this.ael("pointercancel",this.pointerEnd)}else window.addEventListener("mousemove",this.move),window.addEventListener("mouseup",this.pointerEnd)},this.touchStart=e=>{for(const s of Array.from(e.changedTouches))this.triggerPointerStart(t(s),e)},this.move=e=>{const s="changedTouches"in e?Array.from(e.changedTouches).map((e=>t(e))):[t(e)],i=[];for(const t of s){const e=this.currentPointers.findIndex((e=>e.id===t.id));-1!==e&&(i.push(t),this.currentPointers[e]=t)}0!==i.length&&this._h.onMove(i,e)},this._end=(t,e)=>{const s=this.currentPointers.findIndex((e=>e.id===t.id));return-1!==s&&(this.currentPointers.splice(s,1),this.startPointers.splice(s,1),this._h.onEnd&&this._h.onEnd(t,e,"touchcancel"===e.type||"pointercancel"===e.type),!0)},this.pointerEnd=s=>{if(this._end(t(s),s))if(e(s)){if(this.currentPointers.length)return;this.rel("pointermove",this.move),this.rel("pointerup",this.pointerEnd),this.rel("pointercancel",this.pointerEnd)}else window.removeEventListener("mousemove",this.move),window.removeEventListener("mouseup",this.pointerEnd)},this.touchEnd=e=>{for(const s of Array.from(e.changedTouches))this._end(t(s),e)},this._e=s,this._h=i,self.PointerEvent?this.ael("pointerdown",this.pointerStart):(this.ael("mousedown",this.pointerStart),this.ael("touchstart",this.touchStart),this.ael("touchmove",this.move),this.ael("touchend",this.touchEnd),this.ael("touchcancel",this.touchEnd))}ael(t,e){this._e.addEventListener(t,e)}rel(t,e){this._e.removeEventListener(t,e)}stop(){this.rel("pointerdown",this.pointerStart),this.rel("mousedown",this.pointerStart),this.rel("touchstart",this.touchStart),this.rel("touchmove",this.move),this.rel("touchend",this.touchEnd),this.rel("touchcancel",this.touchEnd),this.rel("pointermove",this.move),this.rel("pointerup",this.pointerEnd),this.rel("pointercancel",this.pointerEnd),window.removeEventListener("mousemove",this.move),window.removeEventListener("mouseup",this.pointerEnd)}triggerPointerStart(t,e){return!!this._h.onStart(t,e)&&(this.currentPointers.push(t),this.startPointers.push(t),!0)}}function i(t){return 180/Math.PI*t}function n(t){return Math.PI/180*t}class h{constructor(t,e,i,n=0,h=360){this.anchor=[0,0,0,0],this.degrees=0,this.e=t,this.ri=e,this.ro=i,this.a1=n,this.a2=h,this.tracker=new s(this.e,this)}clamp(t){for(;t<0;)t+=360;return Math.abs(t%360)}isAngleInRange(t){if(this.a1<0){if(t>=0&&t<=this.a2)return!0;const e=t-360;return e>=this.a1&&e<=0}return t>=this.a1&&t<=this.a2}isOnDial(t,e){const s=t-.5,n=e-.5,h=Math.sqrt(s*s+n*n);if(h>=this.ri&&h<=this.ro){const t=this.clamp(Math.round(i(Math.atan2(n,s))));return this.isAngleInRange(t)}return!1}onStart(t,e){e.preventDefault();const s=this.e.getBoundingClientRect();this.anchor=[s.left||s.x,s.top||s.y,s.width,s.height];const i=this.anchor[2],n=this.anchor[3],h=i?(t.clientX-this.anchor[0])/i:0,r=n?(t.clientY-this.anchor[1])/n:0;return!!this.isOnDial(h,r)&&(this.setPosition(h,r),this.e.style.cursor="pointer",!0)}onMove(t){const e=t[0];if(e){const t=this.anchor[2],s=this.anchor[3],i=t?(e.clientX-this.anchor[0])/t:0,n=s?(e.clientY-this.anchor[1])/s:0;this.setPosition(i,n)}}onEnd(){this.e.style.cursor=""}setPosition(t,e){const s=this.clamp(Math.round(i(Math.atan2(e-.5,t-.5))));return!(!this.isAngleInRange(s)||s===this.degrees)&&(this.degrees=s,this.fire(),!0)}fire(){this.e.dispatchEvent(new CustomEvent("p-input",{bubbles:!0,composed:!0,detail:{angle:this.degrees}}))}detach(){this.tracker.stop()}get angle(){return this.degrees}set angle(t){this.degrees=Math.max(this.a1,Math.min(this.a2,this.clamp(t)))}}class r extends HTMLElement{constructor(){super(),this.__n=new Map,this.root=this.attachShadow({mode:"open"})}static get observedAttributes(){return["value"]}attributeChangedCallback(t,e,s){"value"===t&&(this.value=s)}$(t){if(this.__n.has(t))return this.__n.get(t);const e=this.root.querySelector("#"+t);return this.__n.set(t,e),e}$add(t,e,s){"string"==typeof t&&(t=this.$(t)),t&&t.addEventListener(e,s)}$remove(t,e,s){"string"==typeof t&&(t=this.$(t)),t&&t.removeEventListener(e,s)}fire(t,e){!function(t,e,s){const i={bubbles:!0,composed:!0,detail:s};t.dispatchEvent(new CustomEvent(e,i))}(this,t,e)}disconnectedCallback(){this.__n.clear()}}const o=/^hsla\s*\(\s*(\d+.?\d*)\s*,\s*(\d+.?\d*)%\s*,\s*(\d+.?\d*)%\s*,\s*(\d+.?\d*)\s*\)$/i,a=/^hsl\s*\(\s*(\d+.?\d*)\s*,\s*(\d+.?\d*)%\s*,\s*(\d+.?\d*)%\s*\)$/i,d=/^rgba\s*\(\s*(\d+.?\d*)\s*,\s*(\d+.?\d*)\s*,\s*(\d+.?\d*)\s*,\s*(\d+.?\d*)\s*\)$/i,c=/^rgb\s*\(\s*(\d+.?\d*)\s*,\s*(\d+.?\d*)\s*,\s*(\d+.?\d*)\s*\)$/i,l=t=>`hsl(${t[0]%360}, ${t[1]}%, ${t[2]}%)`;function u(t,e,s){t%=360,e/=100,s/=100;const i=(1-Math.abs(2*s-1))*e,n=i*(1-Math.abs(t/60%2-1)),h=s-i/2;let r=0,o=0,a=0;return[r,o,a]=t<60?[i,n,0]:t<120?[n,i,0]:t<180?[0,i,n]:t<240?[0,n,i]:t<300?[n,0,i]:[i,0,n],[Math.round(255*(r+h)),Math.round(255*(o+h)),Math.round(255*(a+h))]}function p(t,e,s){t/=255,e/=255,s/=255;const i=Math.max(t,e,s),n=Math.min(t,e,s),h=i-n;let r=0;0===h?r=0:i===t?r=(e-s)/h%6*60:i===e?r=60*((s-t)/h+2):i===s&&(r=60*((t-e)/h+4));const o=(i+n)/2,a=0===h?0:h/(1-Math.abs(2*o-1));return[Math.round((360+r)%360),Math.round(100*a),Math.round(100*o)]}function g(t,e,s,i){i=Math.round(255*i);let n=Math.round(t).toString(16),h=Math.round(e).toString(16),r=Math.round(s).toString(16),o=i.toString(16);return 1===n.length&&(n="0"+n),1===h.length&&(h="0"+h),1===r.length&&(r="0"+r),1===o.length&&(o="0"+o),(255===i?`#${n}${h}${r}`:`#${n}${h}${r}${o}`).toUpperCase()}class m{constructor(t,e,i){this.anchor=[0,0,0,0],this._a=0,this._d=0,this.e=t,e&&(this._a=this.clampAngle(e)),i&&(this._d=this.clampDist(i)),this.tracker=new s(this.e,this)}clampAngle(t){for(;t<0;)t+=360;return Math.abs(t%360)}clampDist(t){return Math.max(0,Math.min(1,t))}onMove(t){const e=t[0];if(e){const t=this.anchor[2],s=this.anchor[3],i=t?(e.clientX-this.anchor[0])/t:0,n=s?(e.clientY-this.anchor[1])/s:0;this.setPosition(i,n)}}onEnd(){this.e.style.cursor=""}onStart(t,e){e.preventDefault();const s=this.e.getBoundingClientRect();this.anchor=[s.left||s.x,s.top||s.y,s.width,s.height];const i=this.anchor[2],n=this.anchor[3],h=i?(t.clientX-this.anchor[0])/i:0,r=n?(t.clientY-this.anchor[1])/n:0;return this.setPosition(h,r),this.e.style.cursor="pointer",!0}setPosition(t,e){let s=!1;const n=this.clampAngle(Math.round(i(Math.atan2(e-.5,t-.5))));n!==this._a&&(this._a=n,s=!0);const h=t-.5,r=e-.5,o=this.clampDist(2*Math.sqrt(h*h+r*r));return o!==this._d&&(this._d=o,s=!0),s&&this.fire(),s}fire(){this.e.dispatchEvent(new CustomEvent("p-input",{bubbles:!0,composed:!0,detail:{angle:this._a,distance:this._d}}))}detach(){this.tracker.stop()}get angle(){return this._a}set angle(t){this._a=this.clampAngle(t)}get distance(){return this._d}set distance(t){this._d=this.clampDist(t)}}class f extends r{constructor(){super(),this._hsla=[0,100,50,1],this.prevWheelParams=[-1,1],this._renderPending=!1,this.handleDialInput=t=>{const e=t.detail.angle;this._hsla[2]=100/180*e,this.updateColor(),this._fire()},this.handleDiskInput=t=>{const{angle:e,distance:s}=t.detail;this._hsla[0]=e,this._hsla[1]=Math.round(100*s),this.updateColor(),this._fire()},this.root.innerHTML='\n    <style>\n      \n* {box-sizing: border-box;}\n.horizontal {display: flex; flex-direction: row;}\n.vertical {display: flex; flex-direction: column;}\n.center {align-items: center;}\n.flex {flex: 1;}\n\n      :host {\n        display: inline-block;\n        touch-action: none;\n      }\n      canvas {\n        display: block;\n        margin: 0 auto;\n      }\n      #base {\n        position: relative;\n      }\n      #diskPanel {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        display: grid;\n        place-items: center;\n        place-content: center;\n        pointer-events: none;\n      }\n      #wheelThumb,\n      #diskThumb {\n        position: absolute;\n        width: 20px;\n        height: 20px;\n        border-radius: 50%;\n        box-shadow: 0 2px 1px -1px rgba(0,0,0,.2), 0 1px 1px 0 rgba(0,0,0,.14), 0 1px 3px 0 rgba(0,0,0,.12);\n        background: transparent;\n        border: 2px solid #ffffff;\n        top: -10px;\n        left: -10px;\n      }\n      #wheelThumb {\n        pointer-events: none;\n      }\n      #diskThumb {\n        pointer-events: auto;\n        cursor: pointer;\n      }\n      #disk {\n        border-radius: 50%;\n      }\n      #diskTarget {\n        position: relative;\n        border-radius: 50%;\n        pointer-events: auto;\n      }\n    </style>\n    <div id="base">\n      <canvas id="wheel" width="280" height="280"></canvas>\n      <div id="wheelThumb"></div>\n      <div id="diskPanel">\n        <div id="diskTarget">\n          <canvas id="disk" width="200" height="200"></canvas>\n          <div id="diskThumb"></div>\n        </div>\n      </div>\n    </div>\n    '}connectedCallback(){const t=this.$("wheel"),{width:e,height:s}=t,i=Math.min(e,s),n=i/2-2,r=n-20;this.dialC=new h(t,r/i,n/i,0,180),this.$add(t,"p-input",this.handleDialInput);const o=this.$("diskTarget");this.diskC=new m(o,0,0),this.$add(o,"p-input",this.handleDiskInput),this.renderDisk(),this.updateColor()}disconnectedCallback(){this.dialC&&(this.dialC.detach(),this.dialC=void 0),this.diskC&&(this.diskC.detach(),this.diskC=void 0),super.disconnectedCallback()}updateColor(){const[t,e,s]=this._hsla;this.diskC&&(this.diskC.angle=t,this.diskC.distance=e/100),this.dialC&&(this.dialC.angle=1.8*s),this.deferredRender()}deferredRender(){this._renderPending||(this._renderPending=!0,requestAnimationFrame((()=>{this._renderPending=!1,this.updateDiskThumb(),this.updateWheelThumb(),this.renderWheel()})))}updateDiskThumb(){const t=this.$("diskThumb");if(t&&this.diskC){const e=this.diskC.angle,s=100,i=this.diskC.distance*s,h=i*Math.cos(n(e))+s,r=i*Math.sin(n(e))+s;t.style.transform=`translate3d(${h}px, ${r}px, 0)`,t.style.background=l(this._hsla)}}updateWheelThumb(){const t=this.$("wheelThumb");if(t){const e=1.8*this._hsla[2],s=this.$("wheel"),{width:i,height:h}=s,r=Math.min(i,h)/2-10-2.5,o=i/2+r*Math.cos(n(e)),a=h/2+r*Math.sin(n(e));t.style.transform=`translate3d(${o}px, ${a}px, 0)`,t.style.background=l(this._hsla)}}renderWheel(){const[t,e]=this._hsla,[s,i]=this.prevWheelParams;if(t===s&&e===i)return;const n=this.$("wheel"),h=n.getContext("2d"),{width:r,height:o}=n;h.clearRect(0,0,r,o);const a=Math.PI/40,d=Math.min(r,o)/2-2,c=d-20,u=r/2,p=o/2;for(let s=1;s<=40;s++){const i=s*a,n=(s-1)*a,r=c+(d-c)/2,o=Math.cos(i)*r+u,g=Math.sin(i)*r+p,m=Math.cos(n)*r+u,f=Math.sin(n)*r+p,v=[t,e,2.5*s,1],b=[t,e,2.5*(s-1),1],$=h.createLinearGradient(o,g,m,f);$.addColorStop(0,l(v)),$.addColorStop(1,l(b));const x=.002;h.beginPath(),h.arc(u,p,d,n-x,i+x,!1),h.arc(u,p,c,i+x,n-x,!0),h.fillStyle=$,h.fill()}this.prevWheelParams=[t,e]}renderDisk(){const t=200,e=this.$("disk").getContext("2d");e.clearRect(0,0,200,200);const s=document.createElement("canvas");s.width=s.height=t;const i=s.getContext("2d");let h=0;const r=[255,0,0];let o=0;const a=4.322;for(;h++<360;){const d=(o+3-1)%3;r[o]<255?r[o]=r[o]+a>255?255:r[o]+a:r[d]>0?r[d]=r[d]>a?r[d]-a:0:r[o]>=255&&(r[o]=255,o=(o+1)%3),i.clearRect(0,0,t,t);const c=i.createRadialGradient(100,100,0,100,100,100);c.addColorStop(0,"white"),c.addColorStop(1,"rgb("+r.map((function(t){return Math.floor(t)})).join(",")+")"),i.fillStyle=c,i.globalCompositeOperation="source-over",i.beginPath(),i.arc(100,100,100,0,2*Math.PI),i.closePath(),i.fill(),i.globalCompositeOperation="destination-out",i.beginPath(),i.arc(100,100,0,n(h+1),n(h+1)),i.arc(100,100,101,n(h+1),n(h+1)),i.arc(100,100,101,n(h+1),n(h-1)),i.arc(100,100,0,n(h+1),n(h-1)),i.closePath(),i.fill(),e.drawImage(s,0,0)}}_fire(){this.fire("change")}get hsl(){return[...this._hsla]}get rgb(){const[t,e,s]=u(this._hsla[0],this._hsla[1],this._hsla[2]);return[t,e,s,this._hsla[3]]}get value(){return g(...this.rgb)}set value(t){const e=function(t){let e=(t=t.trim()).match(o);if(e){const t=+e[1],s=+e[2],i=+e[3],n=+e[4],[h,r,o]=u(t,s,i);return{hex:g(h,r,o,n),hsla:[t,s,i,n],rgba:[h,r,o,n]}}if(e=t.match(a),e){const t=+e[1],s=+e[2],i=+e[3],[n,h,r]=u(t,s,i);return{hex:g(n,h,r,1),hsla:[t,s,i,1],rgba:[n,h,r,1]}}if(e=t.match(d),e){const t=+e[1],s=+e[2],i=+e[3],n=+e[4],[h,r,o]=p(t,s,i);return{hex:g(t,s,i,n),hsla:[h,r,o,n],rgba:[t,s,i,n]}}if(e=t.match(c),e){const t=+e[1],s=+e[2],i=+e[3],[n,h,r]=p(t,s,i);return{hex:g(t,s,i,1),hsla:[n,h,r,1],rgba:[t,s,i,1]}}let s=t;const i=s.lastIndexOf("#");i>=0&&(s=s.substring(i+1));const n=function(t){switch(t.length){case 3:return[+`0x${t[0]}${t[0]}`,+`0x${t[1]}${t[1]}`,+`0x${t[2]}${t[2]}`,1];case 4:return[+`0x${t[0]}${t[0]}`,+`0x${t[1]}${t[1]}`,+`0x${t[2]}${t[2]}`,+`0x${t[3]}${t[3]}`/255];case 6:return[+`0x${t[0]}${t[1]}`,+`0x${t[2]}${t[3]}`,+`0x${t[4]}${t[5]}`,1];case 8:return[+`0x${t[0]}${t[1]}`,+`0x${t[2]}${t[3]}`,+`0x${t[4]}${t[5]}`,+`0x${t[6]}${t[7]}`/255]}return null}(s);if(n){const[t,e,s,i]=n;if(isNaN(t)||isNaN(e)||isNaN(s)||isNaN(i))return null;const[h,r,o]=p(t,e,s);return{hex:g(t,e,s,i),hsla:[h,r,o,i],rgba:[t,e,s,i]}}return null}(t);e&&(this._hsla=[...e.hsla],this.updateColor())}}customElements.define("disk-color-picker",f);export{f as DiskColorPicker};
